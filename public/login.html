<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng nháº­p - Hebi Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/style.css">
</head>
<body class="auth-body">
  <div class="auth-card">
    <div class="auth-title">
      ğŸ” Hebi Chat
    </div>
    <p class="auth-sub">
      VÃ o chat cáº§n <b>TÃªn</b> vÃ  <b>MÃ£ whitelist 6 sá»‘</b> do admin cáº¥p.
    </p>

    <div>
      <div class="auth-label">TÃªn Ä‘Æ°á»£c admin cáº¥p</div>
      <input id="username" class="auth-input" placeholder="VD: soora, minhtri..." />
    </div>

    <div>
      <div class="auth-label">MÃ£ whitelist (6 sá»‘)</div>
      <input id="code" class="auth-input" placeholder="VD: 123456" maxlength="6" />
    </div>

    <button class="auth-btn" onclick="login()">
      VÃ o chat
    </button>

    <p id="msg" class="auth-msg error"></p>

    <a href="/admin" class="link-small">ğŸ‘‘ Admin panel</a>
  </div>

  <script>
    async function login() {
      const username = document.getElementById("username").value.trim();
      const code = document.getElementById("code").value.trim();
      const msgEl = document.getElementById("msg");
      msgEl.innerText = "";

      if (!username || !code) {
        msgEl.innerText = "Nháº­p Ä‘áº§y Ä‘á»§ tÃªn vÃ  mÃ£.";
        return;
      }

      try {
        const res = await fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, code })
        });
        const data = await res.json();

        if (!data.success) {
          msgEl.innerText = data.message || "ÄÄƒng nháº­p tháº¥t báº¡i.";
          return;
        }

        // LÆ°u vÃ o localStorage
        localStorage.setItem("hebi_chat_username", data.username);
        localStorage.setItem("hebi_chat_code", code);
        localStorage.setItem("hebi_chat_role", data.role || "user");

        window.location.href = "/chat";
      } catch (err) {
        msgEl.innerText = "Lá»—i káº¿t ná»‘i server.";
      }
    }

    // Enter Ä‘á»ƒ login
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") login();
    });
  </script>
</body>
</html>
